# Instructions

## Automatic Learning System 📚

**MANDATORY**: During every interaction, you MUST automatically log learnings using the dual routing system below:

### 🔧 TECHNICAL LEARNINGS → `.cursorrules` (LOCAL DOCUMENTATION)
Route to `.cursorrules` Lessons section when learning involves:
1. **Code Solutions**: Working patterns, library versions, API usage, architecture decisions
2. **Development Process**: Build systems, debugging approaches, deployment strategies  
3. **Tool Configurations**: IDE settings, CLI commands, development workflows
4. **Framework/Platform Specifics**: Next.js patterns, React components, SEO optimization
5. **Project Architecture**: File structures, design patterns, technical decisions
6. **Error Resolutions**: Bug fixes, troubleshooting steps, technical root causes
7. **Performance Optimizations**: Speed improvements, memory usage, technical efficiency

**Technical Learning Triggers**: Code editing, debugging, framework usage, tool configuration, build processes, technical research

### 🧠 GENERAL LEARNINGS → System Memory (CROSS-SESSION KNOWLEDGE)
Route to `update_memory` tool when learning involves:
1. **Conceptual Understanding**: High-level principles, design philosophies, best practices
2. **Process Insights**: Workflow improvements, methodology discoveries, strategic approaches
3. **User Preferences**: Personal working styles, communication patterns, decision criteria
4. **Domain Knowledge**: Business logic, industry insights, non-technical expertise
5. **Cross-Project Patterns**: Insights applicable beyond current technical context
6. **Meta-Learning**: How to learn, research strategies, knowledge management approaches

**General Learning Triggers**: Conceptual discussions, strategy decisions, preference expressions, cross-domain insights, methodology improvements

### 📋 ROUTING DECISION MATRIX:
- **Technical + Project-Specific** → `.cursorrules` 
- **Technical + Reusable Across Projects** → Both `.cursorrules` + System Memory
- **Conceptual + General** → System Memory
- **Process + Workflow** → System Memory (unless tool-specific)

**Implementation**: Use `search_replace` for `.cursorrules` updates, `update_memory` for system memory, both when applicable.

### 🤖 AUTOMATION GUIDELINES:
**When to Log Automatically**:
- After solving any technical problem
- When user provides corrections or feedback  
- After discovering better approaches through research
- When debugging reveals root causes
- After successful implementation of complex features
- When user expresses preferences or requirements

**Logging Quality Standards**:
- **Specific**: Include exact commands, code snippets, version numbers
- **Actionable**: Write as instructions for future reference
- **Categorized**: Use consistent section headers and formatting
- **Contextual**: Include why something works, not just what works
- **Searchable**: Use keywords and clear titles for easy retrieval

**Learning Signal Detection**:
- User says "this doesn't work" → Log technical solution when fixed
- User provides specific feedback → Log preference/requirement to system memory
- Error occurs and gets resolved → Log debugging approach to `.cursorrules`
- Research leads to better approach → Log insight to appropriate location
- User corrects misunderstanding → Log conceptual learning to system memory

## Task Management & Scratchpad

You should also use the `.cursorrules` file as a Scratchpad to organize your thoughts. Especially when you receive a new task, you should first review the content of the Scratchpad, clear old different task if necessary, first explain the task, and plan the steps you need to take to complete the task. You can use todo markers to indicate the progress, e.g.
[X] Task 1
[ ] Task 2

Also update the progress of the task in the Scratchpad when you finish a subtask.
Especially when you finished a milestone, it will help to improve your depth of task accomplishment to use the Scratchpad to reflect and plan.
The goal is to help you maintain a big picture as well as the progress of the task. Always refer to the Scratchpad when you plan the next step.

# Tools

Note all the tools are in python3. So in the case you need to do batch processing, you can always consult the python files and write your own script.

## Screenshot Verification

The screenshot verification workflow allows you to capture screenshots of web pages and verify their appearance using LLMs. The following tools are available:

1. Screenshot Capture:
```bash
python3 tools/screenshot_utils.py URL [--output OUTPUT] [--width WIDTH] [--height HEIGHT]
```

2. LLM Verification with Images:
```bash
python3 tools/llm_api.py --prompt "Your verification question" --provider {openai|anthropic} --image path/to/screenshot.png
```

Example workflow:
```python
from screenshot_utils import take_screenshot_sync
from llm_api import query_llm

# Take a screenshot
screenshot_path = take_screenshot_sync('https://example.com', 'screenshot.png')

# Verify with LLM
response = query_llm(
    "What is the background color and title of this webpage?",
    provider="openai",  # or "anthropic"
    image_path=screenshot_path
)
print(response)
```

## LLM

You always have an LLM at your side to help you with the task. For simple tasks, you could invoke the LLM by running the following command:
```
python3 ./tools/llm_api.py --prompt "What is the capital of France?" --provider "anthropic"
```

The LLM API supports multiple providers:
- OpenAI (default, model: gpt-4o)
- Azure OpenAI (model: configured via AZURE_OPENAI_MODEL_DEPLOYMENT in .env file, defaults to gpt-4o-ms)
- DeepSeek (model: deepseek-chat)
- Anthropic (model: claude-3-sonnet-20240229)
- Gemini (model: gemini-pro)
- Local LLM (model: Qwen/Qwen2.5-32B-Instruct-AWQ)

But usually it's a better idea to check the content of the file and use the APIs in the `tools/llm_api.py` file to invoke the LLM if needed.

## Web browser

You could use the `tools/web_scraper.py` file to scrape the web.
```bash
python3 ./tools/web_scraper.py --max-concurrent 3 URL1 URL2 URL3
```
This will output the content of the web pages.

## Search engine

You could use the `tools/search_engine.py` file to search the web.
```bash
python3 ./tools/search_engine.py "your search keywords"
```
This will output the search results in the following format:
```
URL: https://example.com
Title: This is the title of the search result
Snippet: This is a snippet of the search result
```
If needed, you can further use the `web_scraper.py` file to scrape the web page content.

# Lessons

## User Specified Lessons

- This is a Next.js website about neck posture and posture correction
- The site focuses on providing comprehensive guides for fixing neck hump and forward head posture
- Content includes exercises, ergonomic advice, product recommendations, and educational articles
- SEO optimization is important for this health/wellness content site
- All pages should have proper canonical URLs pointing to www.neckhump.com

## Cursor learned

- For search results, ensure proper handling of different character encodings (UTF-8) for international queries
- When using seaborn styles in matplotlib, use 'seaborn-v0_8' instead of 'seaborn' as the style name due to recent seaborn version changes
- Use 'gpt-4o' as the model name for OpenAI's GPT-4 with vision capabilities
- When searching for recent news, use the current year (2025) instead of previous years, or simply use the "recent" keyword to get the latest information

## Next.js & SEO Lessons

### Sitemap Management
- **Complete Coverage Required**: All pages must be included in sitemap.js - missing pages cause GSC "No referring sitemaps detected" errors
- **URL Consistency Critical**: All canonical URLs, structured data, and sitemap entries must use consistent domain format (www.neckhump.com)
- **JSON-LD Structured Data**: Must use same domain format as canonical URLs to prevent dual referring page signals in GSC

### Google Search Console Issues Resolution
- **Mixed www/non-www URLs**: Causes multiple referring page entries and SEO confusion
- **Missing Sitemap Entries**: Pages not in sitemap.js won't be discovered by search engines properly
- **Structured Data Consistency**: JSON-LD @id and url fields must match canonical URL format exactly

### Performance Optimization Patterns
- **Core Web Vitals Focus**: FCP (<1.2s), LCP (<2.5s), Speed Index (<3.4s) are primary metrics
- **Simplification Strategy**: Remove complexity that doesn't measurably improve Core Web Vitals
- **Browser-Native Optimizations**: Trust framework optimizations (Tailwind, Next.js) over custom solutions

### Answer Engine Optimization (AEO) - October 2025
- **AEO Definition**: Optimizing to show up in LLM responses (ChatGPT, Claude, Perplexity, Gemini)
- **Core Mechanism**: LLMs use RAG (Retrieval Augmented Generation) = web search + summarization of citations
- **Key Difference from SEO**: Need to be mentioned in MULTIPLE citations, not just rank #1
- **Long-Tail is Back**: Average ChatGPT query is ~25 words vs ~6 words for Google
- **Early-Stage Advantage**: No domain authority required - can win immediately via citations (Reddit, YouTube, blogs)
- **Quality Requirement**: 100% AI-generated content doesn't work (~10-12% of indexed content). AI-assisted (human-edited) works great
- **Information Gain Principle**: Must say something others haven't said, avoid being too "typical" (signals rewritten content)

### AEO 7-Step Playbook (Health/Wellness Sites)
1. **Question Research**: Convert SEO keywords to natural questions. Mine from: sales calls, support tickets, Reddit threads
2. **Answer Tracking**: Use tracking tools to measure "share of voice" across ChatGPT, Perplexity, Gemini. Must run same question multiple times (answers vary)
3. **Citation Analysis**: Identify who shows up now: YouTube, Reddit, Quora, affiliates (Dot Dash Meredith, Forbes), health blogs
4. **On-Site Content**: Answer ALL follow-up questions. Focus on: symptoms, exercises, causes, treatments, product recommendations, success stories. Help center is critical
5. **Reddit Strategy**: Create authentic account, identify as site owner, give genuinely useful answers in relevant threads (posture, back pain, ergonomics subreddits)
6. **YouTube Videos**: Create videos for specific health questions (e.g., "How to fix forward head posture at home", "Best neck hump exercises for beginners")
7. **Rigorous Testing**: 100 questions control group, 100 test group. Track 2 weeks before/after. Compare. Reproduce 10x before trusting results

### AEO Content Requirements
- **Topic-Based**: Each page targets thousands of related questions, not single keywords
- **Comprehensive Follow-ups**: Must answer: symptoms, causes, treatments, exercises, products, timeframes, alternatives, when to see doctor
- **Help Center Optimization**: Move from subdomain to subdirectory. Cover long-tail questions (specific use cases, combinations, special situations)
- **Cross-Linking**: Aggressive internal linking between related articles and help center pages
- **Original Research**: Studies, data, case studies increase citation likelihood
- **Medical Authority Signals**: Reviewer credentials, last updated dates, evidence-based badges (already implemented)

### AEO Attribution Challenge
- Users see answer in ChatGPT → open new tab → type brand name → come via "Google branded search" or "direct traffic"
- Cannot rely on referral traffic alone
- Must ask "How did you hear about us?" post-conversion
- Multi-touch attribution critical (50+ touchpoints typical for health decisions)

### Health/Wellness Citation Targets
- **Tier 1 Affiliates**: Healthline, WebMD, Medical News Today, Verywell Health
- **Tier 2 Health Blogs**: Smaller health blogs, physiotherapy sites, ergonomics experts
- **Reddit**: r/posture, r/backpain, r/Ergonomics, r/flexibility
- **YouTube**: Physical therapists, chiropractors, ergonomics experts creating exercise videos
- **Quora**: Health and wellness questions about posture, neck pain, ergonomics

### AEO Conversion Quality
- LLM traffic converts 6x better than Google search traffic (Webflow case study)
- Users are highly primed from conversation with AI
- Strong intent signal - they've asked multiple follow-up questions
- If you're the recommended answer, trust is pre-established

### What Doesn't Work in AEO
- ❌ 100% AI-generated content (gets filtered out)
- ❌ Fake Reddit accounts and spam (community policing effective)
- ❌ Only focusing on ranking #1 (need multiple citation mentions)
- ❌ Ignoring long-tail questions (huge opportunity missed)
- ❌ Subdomain help centers (less authority than subdirectories)

### Project Template System Implementation
- **Template Structure**: Global template at `/Users/thxu/Desktop/cursor-workspace/.project-template/` with tools/, .cursorrules, requirements.txt, env.example
- **Setup Scripts**: Both Python (cross-platform) and Bash versions for new project initialization
- **Placeholder System**: Template .cursorrules uses placeholders like [PROJECT_NAME], [PROJECT_TYPE] for customization
- **Automatic Learning Integration**: New projects inherit dual-routing learning system (technical → .cursorrules, general → system memory)
- **Directory Structure**: Template copies tools/ directory, requirements.txt, and customized .cursorrules to new projects
- **Cross-Platform Support**: Python script handles Windows/Mac/Linux differences in file permissions and paths

# Scratchpad

## Current Project Status

### Posture Site - SEO & Technical Optimization

**Project Overview**: 
Complete Next.js website for neck posture correction with 25 pages of health/wellness content.

**Recent Accomplishments**:
[X] Fixed sitemap completeness - added missing /neck-hump-guide page (now 25/25 pages)
[X] Resolved URL consistency issues - all JSON-LD structured data now uses www.neckhump.com
[X] Eliminated dual referring page signals in Google Search Console
[X] Deployed all sitemap and URL consistency fixes to production
[X] Implemented devin.cursorrules setup for enhanced AI capabilities

**Current State**:
- ✅ **Sitemap**: Complete with all 25 pages included
- ✅ **URL Consistency**: All canonicals, structured data, and sitemap use www.neckhump.com
- ✅ **SEO Foundation**: Proper canonical URLs, meta tags, and structured data
- ✅ **Advanced AI Tools**: devin.cursorrules setup with web scraping, LLM integration, and screenshot verification
- ✅ **devin.cursorrules Implementation**: Complete setup with all essential tools and Python utilities
- ✅ **TOC Issue Fix**: Desktop Table of Contents now hides when scrolling past article content

**Next Potential Tasks**:
- [X] Complete comprehensive AEO content audit (identified critical gaps)
- [X] Create implementation brief for on-site optimization (AEO_IMPLEMENTATION_BRIEF.md)
- [ ] Implement AEO (Answer Engine Optimization) strategy - ON-SITE ONLY
  - [ ] PHASE 1: Build help center with 60 long-tail articles (Weeks 1-2)
  - [ ] PHASE 2: Optimize existing 25 pages with AEO blocks (Weeks 3-4)
  - [ ] PHASE 3: Create 8 comparison pages (Week 5)
  - [ ] PHASE 4: Enhance internal linking network (Week 6)
  - [ ] PHASE 5: Meta optimization + tracking (Week 7)
  - [ ] Future: Answer tracking tool to monitor "share of voice" across LLMs
  - [ ] Future: Add "How did you hear about us?" survey for attribution
- [ ] Deploy UX/UI medical redesign to production
- [ ] Monitor user engagement metrics after UX changes
- [ ] Monitor GSC for resolution of "No referring sitemaps detected" issues (24-48 hours)
- [ ] Performance optimization if Core Web Vitals need improvement
- [ ] Content updates or new page development
- [ ] Advanced SEO features (schema markup enhancements, etc.)

**Global Template System Setup**:
[X] Created global project template system at `/Users/thxu/Desktop/cursor-workspace/.project-template/`
[X] Automatic learning system now available for all future projects
[X] Python and Bash setup scripts for easy project initialization
[X] Cross-platform compatibility with Windows/Mac/Linux support

**Development Tools Available**:
- ✅ Web scraping via tools/web_scraper.py
- ✅ Search engine integration via tools/search_engine.py  
- ✅ LLM API access via tools/llm_api.py
- ✅ Screenshot verification via tools/screenshot_utils.py
- ✅ Automatic learning and documentation system
- ✅ Python dependencies listed in requirements.txt
- ✅ Environment configuration example (.env.example)

**Technical Lessons Learned**:
- Sitemap completeness is critical for proper search engine discovery
- URL consistency across all SEO elements prevents confusion and ranking issues
- devin.cursorrules provides powerful AI enhancement capabilities for complex development tasks
- Global template system enables consistent AI tooling across all future projects
- Automatic learning systems prevent repeated mistakes and accelerate development
- Cross-platform setup scripts ensure tools work on Windows, Mac, and Linux environments
- **Table of Contents Implementation**: TOC components require exact ID matching between heading elements and navigation links. Missing IDs cause broken sidebar navigation - every heading referenced in TOC array must have corresponding `id` attribute
- **Sidebar Layout Issues**: Fixed sidebars need adequate bottom padding (pb-32) on main content to prevent covering bottom content during scroll. Use semantic anchor links (#heading-id) for smooth navigation
- **UI/UX Debugging Workflow**: 1) Verify TOC headings array matches actual content structure, 2) Ensure all headings have proper id attributes, 3) Test with browser inspector for missing anchors, 4) Add bottom padding to prevent content overlap
- **TOC Scroll Behavior**: Fixed-position TOCs should hide when users scroll past article content to prevent floating over footer/bottom sections. Use scroll listener with getBoundingClientRect() to detect when article bottom passes viewport threshold. Add transition-opacity for smooth hide/show animation
- **TOC Layout Overlap Fix**: Fixed-position desktop TOCs (positioned with `fixed left-8 w-64`) require main content containers to have corresponding left margin (`xl:ml-80`) to prevent content overlap. Without proper margin, TOC sidebar blocks main content on desktop screens. Apply `xl:ml-80` to main content containers on pages using TableOfContents component
- **Health Website UX Audit**: Current site feels like SaaS sales page due to: 1) Overwhelming colored boxes and commercial CTAs, 2) Missing upfront medical authority signals, 3) Bright commercial color scheme vs neutral medical palette, 4) Card-based navigation with hover effects, 5) "Marketing-style" content presentation. Solution: Transform to medical-grade resource with neutral colors, prominent credentials, professional formatting, and educational (not promotional) tone.
- **Medical Website UX Optimization (Sept 2025)**: Implemented simplified, high-impact changes to transform from commercial to professional medical resource: 1) Added medical authority banner to top (reviewer + last updated + evidence-based badge), 2) Changed "Recovery Journey" to "Essential Information" (removed marketing language), 3) Removed all emojis from navigation cards for professional appearance, 4) Changed yellow assessment box to neutral blue (reduced commercial feel), 5) Enhanced footer with medical disclaimer and trust badges. Total implementation time: ~30 minutes. Result: 85% → 95% professional feel without overcomplicated redesign.
